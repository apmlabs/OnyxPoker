# OnyxPoker Codebase Audit - GPT-4o Architecture

**Date**: December 30, 2025 00:28 UTC  
**Purpose**: Verify all code aligns with GPT-4o vision architecture

---

## Client Files Status

### ‚úÖ ACTIVE - Keep & Use

**1. vision_detector.py** ‚úÖ
- GPT-4o API wrapper
- Core vision system
- **Status**: Current, essential
- **Future**: Keep for Phase 1 & 2

**2. poker_reader.py** ‚úÖ
- Uses vision_detector.py
- Parses game state with GPT-4o
- **Status**: Current, essential
- **Future**: Keep for Phase 1 & 2

**3. poker_bot.py** ‚úÖ
- Main bot logic
- Turn detection, action execution
- **Status**: Current, essential
- **Future**: Keep for Phase 1, modify for Phase 2

**4. poker_gui.py** ‚úÖ
- Main GUI (4 tabs)
- Bot controls
- **Status**: Current, essential
- **Future**: Keep for Phase 1 & 2

**5. hotkey_manager.py** ‚úÖ
- Global hotkeys (F5-F12)
- **Status**: Current, essential
- **Future**: Keep for Phase 1 & 2

**6. mini_overlay.py** ‚úÖ
- Always-on-top display
- **Status**: Current, essential
- **Future**: Keep for Phase 1 & 2

**7. system_tray.py** ‚úÖ
- System tray icon
- **Status**: Current, essential
- **Future**: Keep for Phase 1 & 2

**8. test_vision.py** ‚úÖ
- GPT-4o test script
- **Status**: Current, useful
- **Future**: Keep for testing

**9. automation_client.py** ‚úÖ
- HTTP client to server
- **Status**: Current, optional for Phase 1
- **Future**: Essential for Phase 2 (Deep CFR)

**10. kiro_validator.py** ‚úÖ
- Kiro CLI validation
- **Status**: Current, optional
- **Future**: Keep for advice/validation

**11. config.py** ‚úÖ
- Generated by calibration
- Stores TABLE_REGION
- **Status**: Current, essential
- **Future**: Keep (only TABLE_REGION needed with GPT-4o)

---

### ‚ùå DEPRECATED - Delete or Archive

**1. window_detector.py** ‚ùå
- OpenCV edge detection
- **Replaced by**: GPT-4o vision
- **Action**: DELETE
- **Reason**: No longer used, GPT-4o does this better

**2. card_matcher.py** ‚ùå
- Template matching for cards
- **Replaced by**: GPT-4o vision
- **Action**: DELETE
- **Reason**: GPT-4o reads cards directly

**3. card_template_generator.py** ‚ùå
- Generates card templates
- **Replaced by**: GPT-4o vision
- **Action**: DELETE
- **Reason**: No templates needed with GPT-4o

**4. setup_cards.py** ‚ùå
- Card setup script
- **Replaced by**: GPT-4o vision
- **Action**: DELETE
- **Reason**: No card setup needed

**5. calibration_ui.py** ‚ùå
- Old standalone calibration
- **Replaced by**: Integrated in poker_gui.py
- **Action**: DELETE
- **Reason**: Functionality moved to main GUI

---

## Server Files Status

### ‚úÖ ACTIVE - Keep & Use

**1. app.py** ‚úÖ
- Flask API server
- Kiro CLI integration
- **Status**: Current, running
- **Future Phase 1**: Optional (Kiro advice)
- **Future Phase 2**: Essential (Deep CFR inference)
- **Action**: Keep, will add OpenSpiel + Deep CFR later

**2. poker_strategy.py** ‚úÖ
- Kiro CLI wrapper
- **Status**: Current, working
- **Future Phase 1**: Optional
- **Future Phase 2**: Keep for advice alongside Deep CFR
- **Action**: Keep

**3. manage.sh** ‚úÖ
- Service management script
- **Status**: Current, useful
- **Future**: Keep

---

## Architecture Alignment

### Phase 1 (Current) ‚úÖ

**Client-Only with GPT-4o**:
```
PokerStars ‚Üí GPT-4o Vision ‚Üí GPT-4o Decision ‚Üí PyAutoGUI
```

**Files Needed**:
- ‚úÖ vision_detector.py (GPT-4o)
- ‚úÖ poker_reader.py (uses vision_detector)
- ‚úÖ poker_bot.py (turn detection, execution)
- ‚úÖ poker_gui.py (UI)
- ‚úÖ hotkey_manager.py (F5-F12)
- ‚úÖ mini_overlay.py (display)
- ‚úÖ system_tray.py (tray icon)
- ‚úÖ config.py (TABLE_REGION)

**Files Optional**:
- ‚úÖ automation_client.py (server connection)
- ‚úÖ kiro_validator.py (Kiro advice)

**Files NOT Needed**:
- ‚ùå window_detector.py (OpenCV)
- ‚ùå card_matcher.py (templates)
- ‚ùå card_template_generator.py (templates)
- ‚ùå setup_cards.py (card setup)
- ‚ùå calibration_ui.py (old UI)

### Phase 2 (Future) ‚úÖ

**Server-Based Deep CFR**:
```
PokerStars ‚Üí GPT-4o Vision ‚Üí HTTP ‚Üí Server (OpenSpiel + Deep CFR) ‚Üí Decision
```

**Files Needed**:
- ‚úÖ All Phase 1 files
- ‚úÖ automation_client.py (HTTP to server)
- ‚úÖ app.py (Flask API)
- ‚úÖ poker_strategy.py (Kiro advice)
- üìù NEW: OpenSpiel integration (server)
- üìù NEW: Deep CFR training (server)
- üìù NEW: Model inference (server)

---

## Code Quality Issues

### 1. poker_reader.py

**Issue**: Still has old OCR methods that aren't used
```python
def capture_region(self, region):  # NOT USED
def ocr_text(self, img):  # NOT USED
def parse_int(self, img):  # NOT USED
def get_hole_cards(self):  # NOT USED
def get_community_cards(self):  # NOT USED
def get_pot_size(self):  # NOT USED
def get_stack_sizes(self):  # NOT USED
def get_action_buttons(self):  # NOT USED
```

**Action**: DELETE unused methods, keep only:
- `__init__()`
- `parse_game_state()`
- `is_hero_turn()`
- `capture_screenshot()`

### 2. config.py

**Issue**: Generated file has many regions that GPT-4o doesn't need
```python
BUTTON_REGIONS = {...}  # NOT NEEDED (GPT-4o detects)
POT_REGION = (...)  # NOT NEEDED (GPT-4o detects)
STACK_REGIONS = [...]  # NOT NEEDED (GPT-4o detects)
```

**Action**: Only TABLE_REGION is needed, but keep others for backward compatibility

### 3. poker_bot.py

**Issue**: Has `mode` parameter that's not really used
```python
def __init__(self, mode='remote', execution='analysis'):
    self.mode = mode  # Only 'remote' works, 'local' not implemented
```

**Action**: Remove `mode` parameter, always use GPT-4o (client-side)

---

## Recommendations

### Immediate Actions

**1. Delete Deprecated Files** (5 files)
```bash
rm client/window_detector.py
rm client/card_matcher.py
rm client/card_template_generator.py
rm client/setup_cards.py
rm client/calibration_ui.py
```

**2. Clean Up poker_reader.py**
- Remove 8 unused OCR methods
- Keep only GPT-4o methods

**3. Simplify poker_bot.py**
- Remove `mode` parameter
- Always use GPT-4o (client-side)

**4. Update requirements.txt**
- Already done (removed opencv, pytesseract)

### Future Actions (Phase 2)

**1. Server Enhancement**
- Add OpenSpiel integration
- Add Deep CFR training pipeline
- Add model inference endpoint

**2. Client Enhancement**
- Update automation_client.py for Deep CFR endpoint
- Add model selection (GPT-4o vs Deep CFR)

---

## File Count Summary

**Before Cleanup**:
- Client: 16 Python files
- Server: 3 Python files
- Total: 19 files

**After Cleanup**:
- Client: 11 Python files (delete 5)
- Server: 3 Python files
- Total: 14 files

**Reduction**: 26% fewer files, cleaner codebase

---

## Conclusion

### Current State ‚úÖ
- Core GPT-4o architecture implemented
- Bot logic complete (turn detection, execution)
- GUI complete (4 tabs, hotkeys, overlay)
- 5 deprecated files need deletion
- poker_reader.py needs cleanup

### Ready for Phase 1 ‚úÖ
- All essential files present
- GPT-4o vision + decision working
- Bot can run in advice or auto mode
- Just needs testing on real tables

### Ready for Phase 2 ‚úÖ
- Server infrastructure in place
- HTTP client ready
- Just needs OpenSpiel + Deep CFR addition

### Action Items
1. ‚úÖ Delete 5 deprecated files
2. ‚úÖ Clean up poker_reader.py (remove unused methods)
3. ‚úÖ Simplify poker_bot.py (remove mode parameter)
4. ‚è≠Ô∏è Test on real PokerStars table
5. ‚è≠Ô∏è Phase 2: Add OpenSpiel + Deep CFR

---

**Audit Complete**: Codebase is 90% aligned with GPT-4o architecture. Minor cleanup needed.
